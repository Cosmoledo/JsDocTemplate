"use strict";function copyFile(e,n,t){function a(e){o||(t(e),o=!0)}let o=!1;const l=fs.createReadStream(e),r=fs.createWriteStream(n);l.on("error",e=>a(e)),r.on("error",e=>a(e)),r.on("close",()=>a()),l.pipe(r)}function find(e){return helper.find(data,e)}function tutoriallink(e){return helper.toTutorial(e,null,{classname:"disabled",prefix:"Tutorial: ",tag:"em"})}function getAncestorLinks(e){return helper.getAncestorLinks(data,e)}function hashToLink(e,n){return/^(#.+)/.test(n)?`<a target="_blank" href="${helper.createLink(e).replace(/(#.+|$)/,n)}">${n}</a>`:n}function needsSignature(e){let n=!1;if("function"===e.kind||"class"===e.kind&&!e.hideconstructor)n=!0;else if("typedef"===e.kind&&e.type&&e.type.names&&e.type.names.length){for(let t=0,a=e.type.names.length;t<a;t++)if("function"===e.type.names[t].toLowerCase()){n=!0;break}}else"namespace"===e.kind&&e.meta&&e.meta.code&&e.meta.code.type&&e.meta.code.type.match(/[Ff]unction/)&&(n=!0);return n}function getSignatureAttributes(e){const n=[];return e.optional&&n.push("opt"),e.nullable===!0?n.push("nullable"):e.nullable===!1&&n.push("non-null"),n}function updateItemName(e){const n=getSignatureAttributes(e);let t=e.name||"";return e.variable&&(t="&hellip;"+t),n&&n.length&&(t=`${t}<span class="signature-attributes">${n.join(", ")}</span>`),t}function addParamAttributes(e){return e.filter(e=>e.name&&e.name.indexOf(".")===-1).map(updateItemName)}function buildItemTypeStrings(e){const n=[];return e&&e.type&&e.type.names&&e.type.names.forEach(e=>n.push(linkto(e,htmlsafe(e)))),n}function buildAttribsString(e){let n="";return e&&e.length&&(n=htmlsafe(`(${e.join(", ")}) `)),n}function addNonParamAttributes(e){let n=[];return e.forEach(e=>n=n.concat(buildItemTypeStrings(e))),n}function addSignatureParams(e){const n=e.params?addParamAttributes(e.params):[];e.signature=`${e.signature||""}(${n.join(", ")})`}function addSignatureReturns(e){const n=[],t=e.yields||e.returns;let a="",o=[],l="";t&&(t.forEach(e=>{helper.getAttribs(e).forEach(e=>{n.indexOf(e)===-1&&n.push(e)})}),a=buildAttribsString(n)),t&&(o=addNonParamAttributes(t)),o.length&&(l=` &rarr; ${a}{${o.join("|")}}`),e.signature=`<span class="signature">${e.signature||""}</span><span class="type-signature">${l}</span>`}function addSignatureTypes(e){const n=e.type?buildItemTypeStrings(e):[];e.signature=`${e.signature||""}<span class="type-signature">${n.length?" :"+n.join("|"):""}</span>`}function addAttribs(e){const n=buildAttribsString(helper.getAttribs(e));e.attribs=`<span class="type-signature">${n}</span>`}function shortenPaths(e,n){return Object.keys(e).forEach(t=>e[t].shortened=e[t].resolved.replace(n,"").replace(/\\/g,"/")),e}function getPathFromDoclet(e){return e.meta?e.meta.path&&"null"!==e.meta.path?path.join(e.meta.path,e.meta.filename):e.meta.filename:null}function generate(e,n,t,a,o){o=o!==!1;const l={docs:t,title:n,type:e},r=path.join(outdir,a);let i=view.render("container.tmpl",l);o&&(i=helper.resolveLinks(i)),fs.writeFileSync(r,i,"utf8")}function generateSourceFiles(e,n){n=n||"utf8",Object.keys(e).forEach(t=>{let a;const o=helper.getUniqueFilename(e[t].shortened);helper.registerLink(e[t].shortened,o);try{a={code:helper.htmlsafe(fs.readFileSync(e[t].resolved,n)),kind:"source"}}catch(e){logger.error("Error while generating source file %s: %s",t,e.message)}generate("Source",e[t].shortened,[a],o,!1)})}function attachModuleSymbols(e,n){const t={};return e.forEach(e=>{t[e.longname]=t[e.longname]||[],t[e.longname].push(e)}),n.map(e=>{t[e.longname]&&(e.modules=t[e.longname].filter(e=>e.description||"class"===e.kind).map(e=>{return e=doop(e),("class"===e.kind||"function"===e.kind&&!e.hideconstructor)&&(e.name=e.name.replace("module:","(require('")+"'))"),e}))})}function buildMemberNav(e,n,t,a){let o="";if(e&&e.length){const l=env&&env.conf&&env.conf.jsdoctemplate||{},r="number"==typeof l.navLevel&&l.navLevel>=0?l.navLevel:1/0;let i="";e.forEach(function(e){const n=find({kind:"function",memberof:e.longname}),o=find({kind:"member",memberof:e.longname}),s=env&&env.conf||{};let c,u="";l.private===!1&&"private"===e.access||(e.ancestors&&e.ancestors.length>r&&(u+="level-hide"),u=u?` class="${u}"`:"",i+=`<li${u}>`,hasOwnProp.call(e,"longname")?hasOwnProp.call(t,e.longname)||(c=s.templates.default.useLongnameInNav?e.longname:e.name,i+=a(e.longname,c.replace(/\b(module|event):/g,"")),l.static&&o.find(e=>"static"===e.scope)&&(i+="<ul class='members'>",o.forEach(e=>{"static"===e.scope&&(i+="<li data-type='member'",l.collapse&&(i+=" style='display: none;'"),i+=">"+linkto(e.longname,e.name)+"</li>")}),i+="</ul>"),n.length&&(i+="<ul class='methods'>",n.forEach(e=>{i+="<li data-type='method'",l.collapse&&(i+=" style='display: none;'"),i+=">"+linkto(e.longname,e.name)+"</li>"}),i+="</ul>"),t[e.longname]=!0):i+=a("",e.name),i+="</li>")}),""!==i&&(o+=`<h3>${n}</h3><ul>${i}</ul>`)}return o}function linktoTutorial(e,n){return tutoriallink(n)}function linktoExternal(e,n){return linkto(e,n.replace(/(^"|"$)/g,""))}function buildNav(e){let n="<h2><a href='index.html'>Home</a></h2>";const t={},a=env&&env.conf&&env.conf.jsdoctemplate||{};if(a.menu)for(const e in a.menu){n+="<h2><a ";for(const t in a.menu[e])n+=t+`="${a.menu[e][t]}"`;n+=">"+e+"</a></h2>"}const o=["Classes","Modules","Externals","Events","Namespaces","Mixins","Tutorials","Interfaces"],l=a.sectionOrder||o,r={Classes:buildMemberNav(e.classes,"Classes",t,linkto),Events:buildMemberNav(e.events,"Events",t,linkto),Externals:buildMemberNav(e.externals,"Externals",t,linktoExternal),Interfaces:buildMemberNav(e.interfaces,"Interfaces",t,linkto),Mixins:buildMemberNav(e.mixins,"Mixins",t,linkto),Modules:buildMemberNav(e.modules,"Modules",{},linkto),Namespaces:buildMemberNav(e.namespaces,"Namespaces",t,linkto),Tutorials:buildMemberNav(e.tutorials,"Tutorials",{},linktoTutorial)};if(l.forEach(e=>n+=r[e]),e.globals.length){let o="";e.globals.forEach(e=>{!a.typedefs&&"typedef"===e.kind||hasOwnProp.call(t,e.longname)||(o+="<li>"+linkto(e.longname,e.name)+"</li>"),t[e.longname]=!0}),n+=o?"<h3>Global</h3><ul>"+o+"</ul>":"<h3>"+linkto("global","Global")+"</h3>"}return n}const doop=require("jsdoc/util/doop"),fs=require("jsdoc/fs"),helper=require("jsdoc/util/templateHelper"),logger=require("jsdoc/util/logger"),path=require("jsdoc/path"),taffy=require("taffydb").taffy,template=require("jsdoc/template"),htmlsafe=helper.htmlsafe,linkto=helper.linkto,resolveAuthorLinks=helper.resolveAuthorLinks,hasOwnProp=Object.prototype.hasOwnProperty;let data,view,outdir=path.normalize(env.opts.destination);exports.publish=function(e,n,t){function a(e,n,t){const a={children:n.children,content:n.parse(),header:n.title,title:e},o=path.join(outdir,t);let l=view.render("tutorial.tmpl",a);l=helper.resolveLinks(l),fs.writeFileSync(o,l,"utf8")}function o(e){e.children.forEach(e=>{a("Tutorial: "+e.title,e,helper.tutorialToUrl(e.name)),o(e)})}const l=env&&env.conf&&env.conf.jsdoctemplate||{};data=e;const r=env.conf.templates||{};r.default=r.default||{};const i=path.normalize(n.template);view=new template.Template(path.join(i,"tmpl"));const s=helper.getUniqueFilename("index"),c=helper.getUniqueFilename("global");helper.registerLink("global",c),view.layout=r.default.layoutFile?path.getResourcePath(path.dirname(r.default.layoutFile),path.basename(r.default.layoutFile)):"layout.tmpl",helper.setTutorials(t),data=helper.prune(data),l.sort!==!1&&data.sort("longname, version, since"),helper.addEventListeners(data);let u={};const m=[];data().each(e=>{if(l.removeQuotes&&("all"===l.removeQuotes?(e.name&&(e.name=e.name.replace(/"/g,""),e.name=e.name.replace(/'/g,"")),e.longname&&(e.longname=e.longname.replace(/"/g,""),e.longname=e.longname.replace(/'/g,""))):"trim"===l.removeQuotes&&(e.name&&(e.name=e.name.replace(/^"(.*)"$/,"$1"),e.name=e.name.replace(/^'(.*)'$/,"$1")),e.longname&&(e.longname=e.longname.replace(/^"(.*)"$/,"$1"),e.longname=e.longname.replace(/^'(.*)'$/,"$1")))),e.attribs="",e.examples&&(e.examples=e.examples.map(e=>{let n,t;return e&&e.match(/^\s*<caption>([\s\S]+?)<\/caption>(\s*[\n\r])([\s\S]+)$/i)&&(n=RegExp.$1,t=RegExp.$3),{caption:n||"",code:t||e||""}})),e.see&&e.see.forEach((n,t)=>e.see[t]=hashToLink(e,n)),e.meta){let n=getPathFromDoclet(e);u[n]={resolved:n,shortened:null},m.indexOf(n)===-1&&m.push(n)}});const d=(find({kind:"package"})||[])[0];d&&d.name&&(outdir=path.join(outdir,d.name,d.version||"")),fs.mkPath(outdir);const f=path.join(i,"static");fs.ls(f,3).forEach(e=>{const n=fs.toDir(e.replace(f,outdir));fs.mkPath(n),copyFile(e,path.join(n,path.basename(e)),e=>e&&console.error(e))});let p,h,g;r.default.staticFiles&&(p=r.default.staticFiles.include||r.default.staticFiles.paths||[],h=new(require("jsdoc/src/filter").Filter)(r.default.staticFiles),g=new(require("jsdoc/src/scanner").Scanner),p.forEach(e=>{g.scan([e],10,h).forEach(n=>{const t=fs.toDir(e),a=fs.toDir(n.replace(t,outdir));fs.mkPath(a),copyFile(n,path.join(a,path.basename(n)),e=>e&&console.error(e))})})),m.length&&(u=shortenPaths(u,path.commonPrefix(m))),data().each(e=>{const n=helper.createLink(e);if(helper.registerLink(e.longname,n),e.meta){let n=getPathFromDoclet(e);n=u[n].shortened,n&&(e.meta.shortpath=n)}}),data().each(e=>{helper.longnameToUrl[e.longname].indexOf("#")>-1?e.id=helper.longnameToUrl[e.longname].split(/#/).pop():e.id=e.name,needsSignature(e)&&(addSignatureParams(e),addSignatureReturns(e),addAttribs(e))}),data().each(e=>{e.ancestors=getAncestorLinks(e),"member"===e.kind&&(addSignatureTypes(e),addAttribs(e)),"constant"===e.kind&&(addSignatureTypes(e),addAttribs(e),e.kind="member")});const b=helper.getMembers(data);b.tutorials=t.children;const k=!(!r.default||r.default.outputSourceFiles===!1);view.find=find,view.linkto=linkto,view.resolveAuthorLinks=resolveAuthorLinks,view.tutoriallink=tutoriallink,view.htmlsafe=htmlsafe,view.outputSourceFiles=k,view.nav=buildNav(b),attachModuleSymbols(find({longname:{left:"module:"}}),b.modules),k&&generateSourceFiles(u,n.encoding),b.globals.length&&generate("","Global",[{kind:"globalobj"}],c);const v=find({kind:"file"});generate("","Home",find({kind:"package"}).concat([{kind:"mainpage",longname:n.mainpagetitle?n.mainpagetitle:"Main Page",readme:n.readme}]).concat(v),s);const y=taffy(b.classes),S=taffy(b.modules),E=taffy(b.namespaces),j=taffy(b.mixins),x=taffy(b.externals),T=taffy(b.interfaces);Object.keys(helper.longnameToUrl).forEach(e=>{const n=helper.find(S,{longname:e});n.length&&generate("Module",n[0].name,n,helper.longnameToUrl[e]);const t=helper.find(y,{longname:e});t.length&&generate("Class",t[0].name,t,helper.longnameToUrl[e]);const a=helper.find(E,{longname:e});a.length&&generate("Namespace",a[0].name,a,helper.longnameToUrl[e]);const o=helper.find(j,{longname:e});o.length&&generate("Mixin",o[0].name,o,helper.longnameToUrl[e]);const l=helper.find(x,{longname:e});l.length&&generate("External",l[0].name,l,helper.longnameToUrl[e]);const r=helper.find(T,{longname:e});r.length&&generate("Interface",r[0].name,r,helper.longnameToUrl[e])}),o(t)};